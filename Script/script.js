const CouleurPays = (rate) => {
    if (rate > 35) return '#800026';
    if (rate > 25) return '#BD0026';
    if (rate > 15) return '#FD8D3C';
    return '#FED976';
};

const Carte = async () => {
    const response = await fetch('../Data/donnees.json');
    const obesityData = await response.json();

    Object.entries(obesityData).forEach(([nomPays, stats]) => {
        

        const donneeValide = stats.find(annee => annee.AllAdults_Obesity !== null);


        if (donneeValide) {
            const rate = donneeValide.AllAdults_Obesity;

            const selector = `path[name="${nomPays}"], path[id="${nomPays}"], path[class="${nomPays}"]`;
            const targets = document.querySelectorAll(selector);

            targets.forEach(path => {
                path.style.fill = CouleurPays(rate);
            });
        }
    });
};

document.addEventListener('DOMContentLoaded', Carte);











const dataJSON = [
        { "year": 2000, "val": 15 },
        { "year": 2005, "val": 30 },
        { "year": 2010, "val": 55 },
        { "year": 2015, "val": 75 },
        { "year": 2020, "val": 95 }
    ];

    // Votre tracé SVG complet
    const bottlePath = "M57.9099 29.4111L57.9939 30.8203C58.2339 34.8204 59.0585 41.2913 60.7351 47.5479C62.453 53.958 64.9008 59.4904 67.9998 62.2637L68.0066 62.2705L68.0379 62.2988L68.0652 62.3232L68.1209 62.3789C69.8928 64.1511 74.1228 70.0721 79.617 81.418L80.1531 82.5332L80.1551 82.5381L80.7146 83.7227L80.7166 83.7266L80.7537 83.8057L80.7918 83.8867L80.8201 83.9727L80.8455 84.0508C81.3625 85.6018 82.1322 88.093 82.7771 90.5693C83.3907 92.9255 83.9998 95.6592 83.9998 97.5C83.9998 99.4662 83.7179 101.461 83.5447 103.02C83.3574 104.706 83.2842 105.959 83.4588 107.007C83.5506 107.559 83.5966 108.705 83.6345 109.972C83.6762 111.363 83.714 113.228 83.7469 115.444C83.8127 119.88 83.8627 125.77 83.9002 132.195C83.975 145.013 83.9977 159.996 83.9978 169.917C84.1653 172.375 84.3662 176.162 84.4246 179.714C84.4542 181.517 84.4489 183.293 84.3816 184.818C84.3242 186.119 84.21 187.443 83.9705 188.468C83.717 191.572 83.2995 196.25 82.8445 200.483C82.6117 202.65 82.3672 204.721 82.1277 206.415C81.9034 208.002 81.6475 209.543 81.3455 210.449C81.2036 210.875 81.0096 211.855 80.8494 213.357C80.6962 214.795 80.5923 216.532 80.5623 218.361C80.5018 222.049 80.7527 225.778 81.3699 228.116C83.1186 232.81 85.1227 240.567 85.6443 249.079C86.1704 257.665 85.2117 267.371 80.6092 275.48C79.7877 277.021 78.4001 279.286 76.8006 281.223C75.9904 282.204 75.0485 283.196 74.0252 283.967C73.1213 284.648 71.8346 285.4 70.3084 285.491L69.9998 285.5C68.4169 285.5 67.8091 285.698 66.0974 285.861C64.4786 286.015 62.6832 285.996 59.9119 285.441C57.1246 284.884 55.1162 283.7 53.8142 282.321C53.4401 282.917 53.0186 283.538 52.5525 284.147L52.1511 284.657C50.8197 286.292 48.8003 288.267 46.2283 288.91L46.1541 288.929L46.115 288.937L46.0799 288.943L46.0789 288.942C45.8618 288.986 45.5837 289.04 45.2742 289.096V289.5H43.7742C43.4903 289.5 43.1796 289.475 42.8855 289.445C42.5925 289.475 42.2829 289.5 41.9998 289.5H40.4998V289.096C40.1899 289.04 39.9113 288.986 39.6941 288.942V288.943L39.659 288.937L39.6199 288.929L39.5457 288.91C37.1346 288.307 35.2089 286.534 33.8806 284.968L33.6228 284.657C32.9958 283.887 32.4378 283.084 31.9588 282.321C30.6568 283.7 28.6487 284.884 25.8621 285.441C23.0909 285.996 21.2952 286.015 19.6765 285.861C18.1788 285.719 17.5258 285.549 16.326 285.509L15.7742 285.5C14.1126 285.5 12.7129 284.693 11.7488 283.967C10.7255 283.196 9.78359 282.204 8.97341 281.223C7.37385 279.286 5.98628 277.021 5.16482 275.48C0.562174 267.371 -0.396431 257.665 0.129663 249.079C0.651358 240.565 2.65518 232.808 4.40408 228.114C5.02088 225.776 5.27213 222.048 5.21169 218.361C5.1817 216.532 5.0778 214.795 4.92459 213.357C4.76444 211.855 4.57037 210.875 4.42849 210.449C4.12648 209.543 3.87062 208.002 3.64626 206.415C3.40677 204.721 3.16226 202.65 2.92947 200.483C2.47452 196.25 2.05602 191.572 1.80251 188.468C1.56303 187.443 1.44973 186.119 1.39236 184.818C1.32511 183.293 1.31973 181.517 1.34939 179.714C1.40782 176.162 1.60767 172.375 1.77517 169.917C1.77531 159.996 1.79897 145.013 1.8738 132.195C1.91132 125.77 1.9613 119.88 2.02712 115.444C2.06001 113.228 2.09775 111.363 2.13943 109.972C2.17738 108.705 2.22327 107.558 2.31521 107.006C2.48962 105.958 2.41654 104.705 2.22927 103.02C2.0561 101.461 1.77419 99.4662 1.77419 97.5C1.77419 95.6591 2.38327 92.9255 2.99685 90.5693C3.64175 88.093 4.41151 85.6017 4.92849 84.0508L4.95388 83.9727L4.9822 83.8867L5.02029 83.8057L5.0574 83.7266L5.05935 83.7227L5.61892 82.5381L5.62087 82.5332C5.66386 82.443 5.70694 82.3532 5.74978 82.2637V82.25H5.75662C11.4456 70.3604 15.8384 64.1936 17.6531 62.3789L17.7088 62.3232L17.7361 62.2988L17.7674 62.2705L17.7742 62.2637C20.8731 59.4903 23.321 53.9577 25.0388 47.5479C26.7155 41.2913 27.5401 34.8203 27.7801 30.8203L27.864 29.4111L27.948 28H57.826L57.9099 29.4111ZM33.5408 34C33.1287 38.1973 32.2815 43.703 30.8347 49.1016C29.0905 55.6098 26.3147 62.6 21.8758 66.6406C20.8565 67.6758 17.355 72.3678 12.4353 82.25H73.3377C68.4176 72.3669 64.9161 67.6753 63.8972 66.6406C59.4584 62.6 56.6834 55.6096 54.9392 49.1016C53.4925 43.7029 52.6453 38.1973 52.2332 34H33.5408ZM53.9998 0C55.6836 0.000166801 56.8627 1.04645 57.5271 1.86328C58.2193 2.71452 58.6721 3.69198 58.8972 4.36719L58.8992 4.37305L58.9246 4.4502L58.9998 4.67871V22H25.9998V5C25.9998 3.31602 27.0462 2.1371 27.8631 1.47266C28.7142 0.780568 29.6918 0.327665 30.367 0.102539L30.3728 0.100586L30.45 0.0751953L30.6785 0H53.9998ZM31.3738 4C31.0639 4.13169 30.6874 4.33244 30.3865 4.57715C30.1907 4.73651 30.0835 4.86551 30.032 4.94922C30.0111 4.98325 30.003 5.00511 29.9998 5.01465V18H54.9998V5.37109C54.8681 5.06186 54.6669 4.68706 54.4226 4.38672C54.2633 4.19095 54.1343 4.08371 54.0506 4.03223C54.0158 4.0109 53.9934 4.00302 53.9842 4H31.3738Z";

    const chart = document.getElementById('chart');

    dataJSON.forEach((item, index) => {
        const unit = document.createElement('div');
        unit.className = 'bottle-unit';

        unit.innerHTML = `
            <div class="percentage-label">${item.val}%</div>
            <svg class="bottle-svg" viewBox="0 0 86 290">
                <defs>
                    <clipPath id="clip-${index}">
                        <path d="${bottlePath}" />
                    </clipPath>
                </defs>
                
                <path d="${bottlePath}" fill="var(--glass-bg)" />
                
                <rect class="liquid-fill" id="fill-${index}" 
                      x="0" y="290" width="86" height="0" 
                      fill="var(--liquid-color)" clip-path="url(#clip-${index})" />
                
                <path d="${bottlePath}" fill="none" stroke="#334155" stroke-width="1.5" />
            </svg>
            <div class="year-label">${item.year}</div>
        `;

        chart.appendChild(unit);

        // Déclenchement manuel de l'animation pour chaque bouteille
        setTimeout(() => {
    const liquid = document.getElementById(`fill-${index}`);
    if (liquid) {
        const targetHeight = (item.val / 100) * 290;
        const targetY = 290 - targetHeight;

        liquid.setAttribute('height', targetHeight);
        liquid.setAttribute('y', targetY);
    }
}, 200);
    });